<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campa√±a de Donaci√≥n de Ropa - COANIQUEM</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div class="overlay">
      <h1>Campa√±a de Donaci√≥n de Ropa</h1>
      <h2>En apoyo a COANIQUEM</h2>
      <p>Del 20 de agosto al 30 de octubre</p>
    </div>
  </header>

  <section class="info">
    <h3>¬øPor qu√© donar?</h3>
    <p>COANIQUEM ayuda a ni√±os, ni√±as y adolescentes que han sufrido quemaduras, brind√°ndoles tratamiento, rehabilitaci√≥n y apoyo a sus familias. Con tu donaci√≥n, podemos marcar una diferencia en sus vidas.</p>
  </section>

  <section class="detalles">
    <h3>¬øQu√© puedes donar?</h3>
    <div class="cards">
      <div class="card">
        <img src="ropa.jpg" alt="Ropa en buen estado">
        <p>Ropa de adulto y ni√±o en buen estado</p>
      </div>
      <div class="card">
        <img src="zapatos.jpg" alt="Calzado">
        <p>Calzado limpio y en buen estado</p>
      </div>
      <div class="card">
        <img src="accesorios.jpg" alt="Accesorios">
        <p>Accesorios: gorros, bufandas, cinturones, etc.</p>
      </div>
    </div>
  </section>

  <section class="fechas">
    <h3>Fechas y lugar de entrega</h3>
    <p>üìÖ Desde el <strong>20 de agosto</strong> hasta el <strong>30 de octubre</strong></p>
    <p>üìç Colegio Manquecura √ëu√±oa, en la sala del 7¬∞B, o puedes esperar a que pasemos por tu sala</p>
  </section>

  <section class="contacto">
    <h3>Contacto</h3>
    <p>Para m√°s informaci√≥n, comun√≠cate con <strong>Miss Gabriela Morales</strong></p>
    <p>üìß <a href="mailto:gabriela.morales@manquecuranunoa.cl">gabriela.morales@manquecuranunoa.cl</a></p>
  </section>

  <section id="ranking" class="ranking">
    <h3>Cursos con m√°s donaciones</h3>
    <ul id="ranking-list" class="ranking-list"></ul>
    <p class="nota">El curso con m√°s donaciones recibir√° un peque√±o presente como agradecimiento.</p>
    <p id="no-donations" class="nota small">A√∫n no hay donaciones registradas.</p>
  </section>

  <footer>
    <p>¬© 2025 Pogonio Studios. Todos los derechos reservados.</p>
    <p>Este producto es propiedad de Pogonio Studios. Queda prohibida su reproducci√≥n total o parcial sin autorizaci√≥n previa.</p>
    <p>Las marcas comerciales, logotipos y nombres de productos mencionados son propiedad de sus respectivos due√±os.</p>
    <p>El software se proporciona ‚Äútal cual‚Äù, sin garant√≠as de ning√∫n tipo. Pogonio Studios no ser√° responsable de ning√∫n da√±o directo o indirecto derivado del uso de este producto.</p>
  </footer>

  <!-- Trigger escondidito para activar ADMIN -->
  <button id="secret-trigger" title="No hay nada aca" aria-label="activador admin"></button>

  <!-- Modal / panel admin (hidden por defecto) -->
  <div id="admin-modal" class="admin-modal" aria-hidden="true">
    <div class="admin-panel" role="dialog" aria-modal="true" aria-labelledby="admin-title">
      <button id="close-admin" class="close-btn" title="Cerrar" aria-label="Cerrar">‚úï</button>
      <h3 id="admin-title">Ingreso de administrador</h3>

      <div id="admin-login">
        <p>Ingresa el c√≥digo secreto para activar modo ADMIN:</p>
        <input id="admin-code" type="password" placeholder="C√≥digo secreto" aria-label="C√≥digo secreto">
        <button id="admin-auth">Activar</button>
        <p id="auth-msg" class="small" aria-live="polite"></p>
      </div>

      <div id="admin-controls" style="display:none;">
        <p class="small">Modo ADMIN activado. Puedes sumar donaciones:</p>
        <label for="admin-course">Curso</label>
        <select id="admin-course" aria-label="Seleccionar curso"></select>

        <label for="admin-amount">Cantidad a sumar</label>
        <input id="admin-amount" type="number" value="1" aria-label="Cantidad">

        <button id="admin-add">Agregar donaciones</button>
        <p id="admin-status" class="small" aria-live="polite"></p>
      </div>
    </div>
  </div>

  <!-- Script de l√≥gica, admin y Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-database.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-analytics.js";

    // Configuraci√≥n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDIQ0RwXa3mUjl6Vx1BvDrtPOW76LBCRRk",
      authDomain: "coaniquem-campaign.firebaseapp.com",
      databaseURL: "https://coaniquem-campaign-default-rtdb.firebaseio.com",
      projectId: "coaniquem-campaign",
      storageBucket: "coaniquem-campaign.firebasestorage.app",
      messagingSenderId: "655815075273",
      appId: "1:655815075273:web:5016b5b1d8a8d19a22b418",
      measurementId: "G-JYV5V3RG6W"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const analytics = getAnalytics(app);

    const SECRET_CODE = '95241322';
    const courses = [];

    function buildCourses() {
      const list = [];
      const pushRange = (grade, letters) => letters.forEach(l => {
        if (grade==='7¬∞' && l==='B') return;
        list.push({name: `${grade} ${l}`, donations: 0});
      });
      for (let g=1; g<=6; g++) {
        const label=g+'¬∞';
        if (g===3) pushRange(label, ['A','B','C','D','E']);
        else pushRange(label, ['A','B','C','D']);
      }
      ['7¬∞','8¬∞','I¬∞','II¬∞','III¬∞','IV¬∞'].forEach(g => pushRange(g,['A','B','C']));
      return list;
    }

    const initialCourses = buildCourses();
    initialCourses.forEach(c => courses.push(c));

    const rankingList = document.getElementById('ranking-list');
    const noDonations = document.getElementById('no-donations');
    const secretTrigger = document.getElementById('secret-trigger');
    const adminModal = document.getElementById('admin-modal');
    const adminAuthBtn = document.getElementById('admin-auth');
    const adminCodeInput = document.getElementById('admin-code');
    const authMsg = document.getElementById('auth-msg');
    const adminControls = document.getElementById('admin-controls');
    const adminCourseSelect = document.getElementById('admin-course');
    const adminAmount = document.getElementById('admin-amount');
    const adminAdd = document.getElementById('admin-add');
    const adminStatus = document.getElementById('admin-status');
    const closeAdmin = document.getElementById('close-admin');

    function render() {
      rankingList.innerHTML='';
      const sorted = [...courses].sort((a,b)=>b.donations - a.donations || a.name.localeCompare(b.name));
      sorted.forEach(c=>{
        const li=document.createElement('li');
        li.innerHTML='<span class="course">'+c.name+'</span> <span class="badge">'+c.donations+' prendas</span>';
        rankingList.appendChild(li);
      });
      noDonations.style.display = courses.every(c=>c.donations===0)?'block':'none';
    }

    function populateAdminSelect(){
      adminCourseSelect.innerHTML='';
      courses.forEach(c=>{
        const opt = document.createElement('option');
        opt.value = c.name;
        opt.textContent = c.name;
        adminCourseSelect.appendChild(opt);
      });
    }

    const dbRef = ref(db, 'courses');
    onValue(dbRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) return;
      courses.length=0;
      Object.entries(data).forEach(([name, donations])=>{
        courses.push({name, donations});
      });
      render();
      populateAdminSelect();
    });

    function addDonationsFirebase(courseName, amount){
      const course = courses.find(c => c.name===courseName);
      if(!course) return;
      const courseRef = ref(db, 'courses/' + courseName);
      set(courseRef, course.donations + amount);
    }

    secretTrigger.addEventListener('click', ()=>{
      adminModal.style.display='flex';
      adminModal.setAttribute('aria-hidden','false');
      adminCodeInput.value='';
      adminCodeInput.focus();
    });
    closeAdmin.addEventListener('click', ()=>{
      adminModal.style.display='none';
      adminModal.setAttribute('aria-hidden','true');
      authMsg.textContent='';
      adminControls.style.display='none';
    });

    adminAuthBtn.addEventListener('click', ()=>{
      const code = adminCodeInput.value.trim();
      if(code===SECRET_CODE){
        authMsg.textContent='Administrador activado';
        adminControls.style.display='block';
        populateAdminSelect();
      } else {
        authMsg.textContent='C√≥digo incorrecto';
        adminControls.style.display='none';
      }
    });

    adminAdd.addEventListener('click', ()=>{
      const courseName = adminCourseSelect.value;
      const amount = parseInt(adminAmount.value,10);
      if(!Number.isFinite(amount)||amount===0){
        adminStatus.textContent='Ingresa una cantidad distinta de 0';
        return;
      }
      addDonationsFirebase(courseName, amount);
      adminStatus.textContent=`Se actualizaron ${amount>0?'+'+amount:amount} prendas en ${courseName}.`;
      setTimeout(()=>adminStatus.textContent='',3000);
    });

    window.addEventListener('keydown',(e)=>{
      if(e.key==='Escape'){
        adminModal.style.display='none';
        adminModal.setAttribute('aria-hidden','true');
      }
    });

    // Render inicial
    render();
  </script>
</body>
</html>
